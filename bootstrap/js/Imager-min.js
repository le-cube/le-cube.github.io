(function(g,k){var e,n,f,c,b;f=g.requestAnimationFrame||g.mozRequestAnimationFrame||g.webkitRequestAnimationFrame||function(p){g.setTimeout(p,1000/60)};function d(t,p){var r=0,s=t.length,q=[];for(;r<s;r++){q[r]=p(t[r],r)}return q}function j(p){return p}b=(function(){if(Object.prototype.hasOwnProperty.call(k.createElement("img"),"naturalWidth")){return function(p){return p.naturalWidth}}return function(q){var p=k.createElement("img");p.src=q.src;return p.width}})();c=(function(){if(k.addEventListener){return function q(t,r,s){return t.addEventListener(r,s,false)}}else{return function p(t,r,s){return t.attachEvent("on"+r,s)}}})();e=[96,130,165,200,235,270,304,340,375,410,445,485,520,555,590,625,660,695,736];n=typeof Object.keys==="function"?Object.keys:function(p){var r=[],q;for(q in p){r.push(q)}return r};function o(r,q){var p=this,s=k;q=q||{};if(r!==undefined){if(typeof r==="string"){q.selector=r;r=undefined}else{if(typeof r.length==="undefined"){q=r;r=undefined}}}this.imagesOffScreen=[];this.viewportHeight=s.documentElement.clientHeight;this.selector=q.selector||".delayed-image-load";this.className=q.className||"image-replace";this.gif=s.createElement("img");this.gif.src="data:image/gif;base64,R0lGODlhEAAJAIAAAP///wAAACH5BAEAAAAALAAAAAAQAAkAAAIKhI+py+0Po5yUFQA7";this.gif.className=this.className;this.gif.alt="";this.scrollDelay=q.scrollDelay||250;this.onResize=q.hasOwnProperty("onResize")?q.onResize:true;this.lazyload=q.hasOwnProperty("lazyload")?q.lazyload:false;this.scrolled=false;this.availablePixelRatios=q.availablePixelRatios||[1,2];this.availableWidths=q.availableWidths||e;this.onImagesReplaced=q.onImagesReplaced||function(){};this.widthsMap={};this.refreshPixelRatio();this.widthInterpolator=q.widthInterpolator||j;this.gif.removeAttribute("height");this.gif.removeAttribute("width");if(typeof this.availableWidths!=="function"){if(typeof this.availableWidths.length==="number"){this.widthsMap=o.createWidthsMap(this.availableWidths,this.widthInterpolator)}else{this.widthsMap=this.availableWidths;this.availableWidths=n(this.availableWidths)}this.availableWidths=this.availableWidths.sort(function(u,t){return u-t})}if(r){this.divs=d(r,j);this.selector=null}else{this.divs=d(s.querySelectorAll(this.selector),j)}this.changeDivsToEmptyImages();f(function(){p.init()})}o.prototype.scrollCheck=function(){if(this.scrolled){if(!this.imagesOffScreen.length){g.clearInterval(this.interval)}this.divs=this.imagesOffScreen.slice(0);this.imagesOffScreen.length=0;this.changeDivsToEmptyImages();this.scrolled=false}};o.prototype.init=function(){this.initialized=true;this.checkImagesNeedReplacing(this.divs);if(this.onResize){this.registerResizeEvent()}if(this.lazyload){this.registerScrollEvent()}};o.prototype.createGif=function(q){if(q.className.match(new RegExp("(^| )"+this.className+"( |$)"))){return q}var s=q.getAttribute("data-class");var r=q.getAttribute("data-width");var p=this.gif.cloneNode(false);if(r){p.width=r;p.setAttribute("data-width",r)}p.className=(s?s+" ":"")+this.className;p.setAttribute("data-src",q.getAttribute("data-src"));p.setAttribute("alt",q.getAttribute("data-alt")||this.gif.alt);q.parentNode.replaceChild(p,q);return p};o.prototype.changeDivsToEmptyImages=function(){var p=this;d(this.divs,function(r,q){if(p.lazyload){if(p.isThisElementOnScreen(r)){p.divs[q]=p.createGif(r)}else{p.imagesOffScreen.push(r)}}else{p.divs[q]=p.createGif(r)}});if(this.initialized){this.checkImagesNeedReplacing(this.divs)}};o.prototype.isThisElementOnScreen=function(p){var r=o.getPageOffset();var q=0;if(p.offsetParent){do{q+=p.offsetTop}while(p=p.offsetParent)}return(q<(this.viewportHeight+r))?true:false};o.prototype.checkImagesNeedReplacing=function(p){var q=this;if(!this.isResizing){this.isResizing=true;this.refreshPixelRatio();d(p,function(r){q.replaceImagesBasedOnScreenDimensions(r)});this.isResizing=false;this.onImagesReplaced(p)}};o.prototype.replaceImagesBasedOnScreenDimensions=function(r){var p,s,q;q=b(r);p=typeof this.availableWidths==="function"?this.availableWidths(r):this.determineAppropriateResolution(r);r.width=p;if(r.src!==this.gif.src&&p<=q){return}s=this.changeImageSrcToUseNewImageDimensions(r.getAttribute("data-src"),p);r.src=s};o.prototype.determineAppropriateResolution=function(p){return o.getClosestValue(p.getAttribute("data-width")||p.parentNode.clientWidth,this.availableWidths)};o.prototype.refreshPixelRatio=function i(){this.devicePixelRatio=o.getClosestValue(o.getPixelRatio(),this.availablePixelRatios)};o.prototype.changeImageSrcToUseNewImageDimensions=function(r,q){var p=o.transforms.width(q,this.widthsMap);return r.replace(/{width}/g,p).replace(/{pixel_ratio}/g,o.transforms.pixelRatio(this.devicePixelRatio))};o.getPixelRatio=function h(p){return(p||g)["devicePixelRatio"]||1};o.createWidthsMap=function a(q,s){var r={},p=q.length;while(p--){r[q[p]]=s(q[p])}return r};o.transforms={pixelRatio:function(p){return p===1?"":"-"+p+"x"},width:function(p,q){return q[p]||p}};o.getClosestValue=function l(r,s){var q=s.length,p=s[q-1];r=parseFloat(r,10);while(q--){if(r<=s[q]){p=s[q]}}return p};o.prototype.registerResizeEvent=function(){var p=this;c(g,"resize",function(){p.checkImagesNeedReplacing(p.divs)})};o.prototype.registerScrollEvent=function(){var p=this;this.scrolled=false;this.interval=g.setInterval(function(){p.scrollCheck()},p.scrollDelay);c(g,"scroll",function(){p.scrolled=true})};o.getPageOffsetGenerator=function m(p){if(p){return function(){return g.pageYOffset}}else{return function(){return k.documentElement.scrollTop}}};o.getPageOffset=o.getPageOffsetGenerator(Object.prototype.hasOwnProperty.call(g,"pageYOffset"));o.applyEach=d;if(typeof module==="object"&&typeof module.exports==="object"){module.exports=exports=o}else{if(typeof define==="function"&&define.amd){define(function(){return o})}else{if(typeof g==="object"){g.Imager=o}}}}(window,document));